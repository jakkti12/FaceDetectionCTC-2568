import{a as m}from"./CCb-kr4I.js";import{_ as b,r as l,o as B,t as v,v as C,J as I,A as u,B as g,y as f,N as x,z as s,x as n,O as w}from"./gszgXTxS.js";import{V as L}from"./CBkuNycD.js";import{f as U,b as $}from"./Cvl1ETbA.js";import{d as h}from"./BZISSxIt.js";import{V as z}from"./Dt6yrLrZ.js";import{V as A}from"./CD5PZ4Wl.js";const D={class:"profile-section background-body"},F={class:"text-center"},N={style:{color:"#ffffff"}},P={class:"mb-5",style:{color:"#ffffff"}},S={__name:"ProfileComponent",setup(E){const p=l(""),d=l(""),o=l(null),c=l(null),r=l(""),_=l(null),i=l(null),y=t=>{const e=t.target.files[0];e&&(i.value=e,r.value=URL.createObjectURL(e))},k=async()=>{try{if(!i.value){o.value="กรุณาเลือกไฟล์ก่อนอัปโหลด";return}const t=localStorage.getItem("token"),e=new FormData;e.append("picture",i.value);const a=await m.post("http://localhost:7000/upload/upload-single",e,{headers:{authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}});a.data.ok===1?(c.value="เปลี่ยนโปรไฟล์สำเร็จ",r.value=`http://localhost:7000/uploads/profiles/${a.data.file}`,URL.revokeObjectURL(r.value),i.value=null,setTimeout(()=>{c.value=null,o.value=null},3e3)):o.value="เกิดข้อผิดพลาดในการเปลี่ยนแปลงโปรไฟล์"}catch(t){o.value="เกิดข้อผิดพลาด: "+t.message}},V=async()=>{try{const t=localStorage.getItem("token"),a=(await m.get("http://localhost:7000/user/get-user",{headers:{authorization:`Bearer ${t}`}})).data;console.log(a.user.profile),a.ok===1?(r.value=`http://localhost:7000/uploads/profiles/${a.user.profile}`,p.value=a.user.username,d.value=a.user.email):console.log("Error fetching student data:",a.error)}catch(t){console.error("Error fetching student data:",t)}};return B(()=>{V()}),(t,e)=>(v(),C(w,null,[o.value||c.value?(v(),I(L,{key:0,type:o.value?"error":"success",closable:"",title:o.value?"Login Failed":"Login Successful",text:"",variant:"elevated",class:"alert-global"},{default:u(()=>[g(f(o.value||c.value),1)]),_:1},8,["type","title"])):x("",!0),s(A,{class:"container"},{default:u(()=>[n("div",D,[n("div",F,[s(U,{size:"120",class:"mb-4 white avatar"},{default:u(()=>[s($,{src:r.value,alt:"Profile Picture",cover:""},null,8,["src"]),n("input",{type:"file",ref_key:"fileInput",ref:_,accept:"image/*",onChange:y,style:{display:"none"}},null,544),s(h,{icon:"mdi-pencil",size:"small",class:"avatar-edit-btn",color:"white",variant:"flat",onClick:e[0]||(e[0]=a=>t.$refs.fileInput.click())})]),_:1}),n("div",N,"Hello, "+f(p.value),1),n("div",P,f(d.value),1),s(h,{class:"mb-5",color:"#C5D6BA",onClick:k},{default:u(()=>e[1]||(e[1]=[g(" บันทึกรูปภาพ ")])),_:1})])]),s(z)]),_:1})],64))}},q=b(S,[["__scopeId","data-v-ac1d4374"]]);export{q as P};
