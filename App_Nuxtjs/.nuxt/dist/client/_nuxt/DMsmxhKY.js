import{_ as S}from"./CQYZWQCR.js";import{_ as N,V as A,W as O,r as o,F as X,t as m,v,S as Y,x as s,y as P,N as Q,Q as G,T as x,U as V,z as l,A as i,X as J,B as D,O as F,P as K,Y as Z,g as ee}from"./gszgXTxS.js";import{_ as te}from"./7qluULSw.js";import{a as R}from"./CCb-kr4I.js";import{s as se}from"./DN_E0W_O.js";import{d as k}from"./BZISSxIt.js";import{V as ae,e as oe}from"./Cvl1ETbA.js";import{V as le,a as re}from"./CaUlAWcl.js";import"./xT3liDgT.js";import"./1DYzFgek.js";import"./DjbA1_97.js";const ne={class:"container"},ie={class:"row mt-5 justify-content-center"},de={class:"col-md-8 col-lg-6"},ue={class:"card"},ce={class:"card-body"},pe={key:0,class:"error"},me={class:"mb-3"},ve={class:"mb-3"},fe={class:"mb-3"},ge={class:"mb-3"},he={class:""},_e={ref:"canvas",style:{display:"none"}},ye={__name:"RegisterComponent",setup(q){const B=A();O();const f=o(""),g=o(""),d=o(""),h=o(""),u=o(null),r=o(!1),n=o("กำลังโหลด..."),_=o(null),y=o(null),I=o(null),c=o([]),C=o(""),T=t=>{if(t.preventDefault(),d.value!==h.value){u.value="รหัสผ่านไม่ตรงกัน";return}r.value=!0},W=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0});_.value.srcObject=t,y.value=t,n.value="กำลังตรวจจับใบหน้า...",I.value=se(j,2e3)}catch(t){console.error("ไม่สามารถเข้าถึงกล้องได้:",t),n.value="ไม่สามารถเข้าถึงกล้องได้"}},U=()=>{r.value=!1,y.value&&(y.value.getTracks().forEach(t=>t.stop()),y.value=null),n.value="กล้องถูกปิด",c.value=[]},j=async()=>{var w;if(!_.value)return;const t=document.createElement("canvas"),e=t.getContext("2d"),a=_.value;t.width=a.videoWidth,t.height=a.videoHeight,e.drawImage(a,0,0,t.width,t.height),C.value=t.toDataURL("image/jpeg").split(",")[1];try{const p=await R.post("http://localhost:8000/detect_face",{image:C.value});if(p.data.status==="success"){const L=p.data.boundingBoxes,M=a.clientWidth,z=a.clientHeight,$=M/t.width,E=z/t.height;c.value=L.map(b=>({x:b.x*$,y:b.y*E,width:b.width*$,height:b.height*E})),n.value="ตรวจพบใบหน้า กรุณากดลงทะเบียน"}else c.value=[],n.value="ไม่พบใบหน้า"}catch(p){console.error("Error detecting face:",((w=p.response)==null?void 0:w.data)||p),c.value=[],n.value="เกิดข้อผิดพลาด"}},H=async()=>{try{const t=await R.post("http://localhost:8000/register",{username:f.value,email:g.value,password:d.value,image:C.value});t.data.status==="success"?(alert("สมัครสมาชิกสำเร็จ"),U(),B.push("/auth/login")):alert(t.data.message)}catch{alert("เกิดข้อผิดพลาดในการสมัคร")}};return X(r,t=>{t?W():U()}),(t,e)=>(m(),v("div",ne,[e[14]||(e[14]=Y('<div class="row text-center mt-5" data-v-58785b15><div class="col" data-v-58785b15><div class="p-2" data-v-58785b15><img style="width:350px;border-radius:100%;" src="'+te+'" alt="Logo" data-v-58785b15></div><h2 data-v-58785b15>สมัครสมาชิก</h2><p data-v-58785b15> หรือ <a href="/auth/login" class="" data-v-58785b15>ลงชื่อเข้าใช้</a></p></div></div>',1)),s("div",ie,[s("div",de,[s("div",ue,[s("div",ce,[u.value?(m(),v("div",pe,P(u.value),1)):Q("",!0),s("form",{onSubmit:G(T,["prevent"])},[s("div",me,[e[5]||(e[5]=s("label",{for:"inputUsername",class:"form-label"},"ชื่อผู้ใช้",-1)),x(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),type:"text",class:"form-control",id:"inputUsername",required:""},null,512),[[V,f.value]])]),s("div",ve,[e[6]||(e[6]=s("label",{for:"inputEmail",class:"form-label"},"อีเมล",-1)),x(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),type:"email",class:"form-control",id:"inputEmail",required:""},null,512),[[V,g.value]])]),s("div",fe,[e[7]||(e[7]=s("label",{for:"inputPassword",class:"form-label"},"รหัสผ่าน",-1)),x(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),type:"password",class:"form-control",id:"inputPassword",required:""},null,512),[[V,d.value]])]),s("div",ge,[e[8]||(e[8]=s("label",{for:"inputConfirmPassword",class:"form-label"},"ยืนยันรหัสผ่าน",-1)),x(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),type:"password",class:"form-control",id:"inputConfirmPassword",required:""},null,512),[[V,h.value]])]),l(re,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value=a),"max-width":"80%",persistent:""},{activator:i(({props:a})=>[l(k,J(a,{class:"w-100",color:"primary"}),{default:i(()=>e[9]||(e[9]=[D(" สมัครสมาชิก ")])),_:2},1040)]),default:i(()=>[l(ae,{"prepend-icon":"mdi-camera",title:"ตรวจสอบใบหน้า"},{default:i(()=>[s("div",he,[s("video",{ref_key:"video",ref:_,autoplay:"",muted:"",playsinline:""},null,512),s("canvas",_e,null,512),(m(!0),v(F,null,K(c.value,(a,w)=>(m(),v("div",{class:"face-box",key:w,style:Z({position:"absolute",border:"2px solid red",top:`${a.y}px`,left:`${a.x}px`,width:`${a.width}px`,height:`${a.height}px`,pointerEvents:"none"})},null,4))),128)),s("p",null,P(n.value),1)]),l(oe,null,{default:i(()=>[l(le),l(k,{color:"green",onClick:H},{default:i(()=>e[10]||(e[10]=[D(" ลงทะเบียน ")])),_:1}),l(k,{color:"red",onClick:U},{default:i(()=>e[11]||(e[11]=[D(" ปิด ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],32),e[12]||(e[12]=s("hr",null,null,-1)),e[13]||(e[13]=s("div",{class:"text-center"},[s("a",{href:"/",class:"link-secondary"},"กลับสู่หน้าหลัก")],-1))])])])])]))}},we=N(ye,[["__scopeId","data-v-58785b15"]]),be={components:{RegisterComponent:we,FooterComponent:S}};function xe(q,B,f,g,d,h){const u=ee("RegisterComponent"),r=S;return m(),v(F,null,[l(u),l(r)],64)}const Ne=N(be,[["render",xe]]);export{Ne as default};
