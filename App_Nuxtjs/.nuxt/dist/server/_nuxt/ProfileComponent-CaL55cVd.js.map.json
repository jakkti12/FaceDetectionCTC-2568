{"file":"ProfileComponent-CaL55cVd.js","mappings":";;;;;;;;;;;;;AA8FA,UAAM,WAAW,IAAI,EAAE;AACvB,UAAM,QAAQ,IAAI,EAAE;AAEpB,UAAM,QAAQ,IAAI,IAAI;AACtB,UAAM,UAAU,IAAI,IAAI;AAExB,UAAM,gBAAgB,IAAI,EAAE;AAC5B,UAAM,YAAY,IAAI,IAAI;AAC1B,UAAM,eAAe,IAAI,IAAI;AAE7B,UAAM,iBAAiB,CAAC,UAAU;AAChC,YAAM,OAAO,MAAM,OAAO,MAAM,CAAC;AACjC,UAAI,MAAM;AACR,qBAAa,QAAQ;AACrB,sBAAc,QAAQ,IAAI,gBAAgB,IAAI;AAAA,MAC/C;AAAA,IACH;AAMA,UAAM,YAAY,YAAY;AAC5B,UAAI;AACF,YAAI,CAAC,aAAa,OAAO;AACvB,gBAAM,QAAQ;AACd;AAAA,QACD;AAED,cAAM,QAAQ,aAAa,QAAQ,OAAO;AAC1C,cAAM,WAAW,IAAI;AACrB,iBAAS,OAAO,WAAW,aAAa,KAAK;AAE7C,cAAM,WAAW,MAAM,MAAM;AAAA,UAC3B;AAAA,UACA;AAAA,UACA;AAAA,YACE,SAAS;AAAA,cACP,iBAAiB,UAAU,KAAK;AAAA,cAChC,gBAAgB;AAAA,YACjB;AAAA,UACF;AAAA,QACP;AAEI,YAAI,SAAS,KAAK,OAAO,GAAG;AAC1B,kBAAQ,QAAQ;AAGhB,wBAAc,QAAQ,0CAA0C,SAAS,KAAK,IAAI;AAGlF,cAAI,gBAAgB,cAAc,KAAK;AACvC,uBAAa,QAAQ;AAGrB,qBAAW,MAAM;AACf,oBAAQ,QAAQ;AAChB,kBAAM,QAAQ;AAAA,UACf,GAAE,GAAI;AAAA,QACb,OAAW;AACL,gBAAM,QAAQ;AAAA,QACf;AAAA,MACF,SAAQ,GAAG;AACV,cAAM,QAAQ,qBAAqB,EAAE;AAAA,MACtC;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../components/settings/ProfileComponent.vue"],"sourcesContent":["<template>\r\n    <v-alert\r\n      v-if=\"error || success\"\r\n      :type=\"error ? 'error' : 'success'\"\r\n      closable\r\n      :title=\"error ? 'Login Failed' : 'Login Successful'\"\r\n      text\r\n      variant=\"elevated\"\r\n      class=\"alert-global\"\r\n    >\r\n      {{ error || success }}\r\n  </v-alert>\r\n    <v-app class=\"container\">\r\n        <div class=\"profile-section background-body\">\r\n            <div class=\"text-center\">\r\n                <v-avatar size=\"120\" class=\"mb-4 white avatar\">\r\n                <!-- แสดงรูปภาพจาก backend -->\r\n                <v-img :src=\"profileImages\" alt=\"Profile Picture\" cover></v-img>\r\n\r\n                  <!-- เพิ่ม input type file แบบซ่อน -->\r\n                  <input type=\"file\" ref=\"fileInput\" accept=\"image/*\" @change=\"onFileSelected\" style=\"display: none\" />\r\n\r\n                  <!-- ปุ่มแก้ไขที่จะเรียก input file -->\r\n                  <v-btn icon=\"mdi-pencil\" size=\"small\" class=\"avatar-edit-btn\" color=\"white\" variant=\"flat\" @click=\"$refs.fileInput.click()\"></v-btn>\r\n              </v-avatar>\r\n              <div style=\"color: #ffffff;\">Hello, {{ Username }}</div>\r\n              <div class=\"mb-5\" style=\"color: #ffffff;\">{{ Email }}</div>\r\n              <v-btn class=\"mb-5\" color=\"#C5D6BA\" @click=\"saveImage\">\r\n                บันทึกรูปภาพ\r\n              </v-btn>\r\n\r\n              <!-- <v-btn class=\"mb-5\" color=\"#C5D6BA\" @click=\"updatedFace\">\r\n                เปลี่ยนโครงหน้า\r\n              </v-btn> -->\r\n          </div>\r\n      </div>\r\n\r\n      <v-main>\r\n          <!-- <v-container>\r\n          <div class=\"text-subtitle-1 mb-2\">ตั้งค่าข้อมูลส่วนตัว</div>\r\n              <v-card flat class=\"mb-4\">\r\n                  <v-list>\r\n                    <v-list-item>\r\n                        <v-btn @click=\"openDialog(item.id)\" >\r\n                        <template v-slot:prepend>\r\n                        <v-icon>mdi-key</v-icon>\r\n                        </template>\r\n                        <v-list-item-title>Change Password</v-list-item-title>\r\n                        <template v-slot:append>\r\n                        <v-icon>mdi-chevron-right</v-icon>\r\n                        </template>\r\n                        </v-btn>\r\n\r\n                        <v-dialog\r\n                          v-model=\"dialog[item.id]\"\r\n                          max-width=\"800\"\r\n                          persistent\r\n                          transition=\"dialog-bottom-transition\"\r\n                        >\r\n                          <v-card\r\n                            prepend-icon=\"mdi-eye\"\r\n                            title=\"เช็คข้อมูล\"\r\n                            class=\"dialog-card\"\r\n                          >\r\n                            <v-card-text>\r\n                              <CheckIineComponent \r\n                                :week_id=\"week_id\"\r\n                                :day_id=\"item.id\"\r\n                                @submit=\"handleSubmit\"\r\n                                @update=\"handleUpdate\"\r\n                              />\r\n                            </v-card-text>\r\n                            <template v-slot:actions>\r\n                              <v-spacer></v-spacer>\r\n                              <v-btn @click=\"closeDialog(item.id)\" color=\"red\" class=\"btn-close\">\r\n                                <h5>ปิด</h5>\r\n                              </v-btn>\r\n                            </template>\r\n                          </v-card>\r\n                        </v-dialog>\r\n\r\n                    </v-list-item>\r\n                  </v-list>\r\n              </v-card>\r\n          </v-container> -->\r\n      </v-main>\r\n  </v-app>\r\n</template>\r\n\r\n<script setup>\r\nimport { useRouter , useRoute  } from 'vue-router';\r\nimport { ref, onMounted } from 'vue';\r\nimport axios from 'axios';\r\n\r\nconst Username = ref('');\r\nconst Email = ref('');\r\n\r\nconst error = ref(null);\r\nconst success = ref(null);\r\n\r\nconst profileImages = ref('');\r\nconst fileInput = ref(null);\r\nconst selectedFile = ref(null); // เก็บไฟล์ที่เลือก\r\n\r\nconst onFileSelected = (event) => {\r\n  const file = event.target.files[0];\r\n  if (file) {\r\n    selectedFile.value = file; \r\n    profileImages.value = URL.createObjectURL(file); // แสดงตัวอย่างรูปที่เลือก\r\n  }\r\n};\r\n\r\n// const openDialog = (id) => {\r\n//     state.dialog[id] = true;\r\n// };\r\n\r\nconst saveImage = async () => {\r\n  try {\r\n    if (!selectedFile.value) {\r\n      error.value = 'กรุณาเลือกไฟล์ก่อนอัปโหลด';\r\n      return;\r\n    }\r\n\r\n    const token = localStorage.getItem('token');\r\n    const formData = new FormData();\r\n    formData.append(\"picture\", selectedFile.value);\r\n\r\n    const response = await axios.post(\r\n      'http://localhost:7000/upload/upload-single', \r\n      formData, \r\n      {\r\n        headers: {\r\n          'authorization': `Bearer ${token}`,\r\n          'Content-Type': 'multipart/form-data',\r\n        },\r\n      }\r\n    );\r\n\r\n    if (response.data.ok === 1) {\r\n      success.value = 'เปลี่ยนโปรไฟล์สำเร็จ';\r\n\r\n      // อัปเดต URL รูปโปรไฟล์จากเซิร์ฟเวอร์\r\n      profileImages.value = `http://localhost:7000/uploads/profiles/${response.data.file}`;\r\n\r\n      // ล้างข้อมูลที่เลือกก่อนหน้า\r\n      URL.revokeObjectURL(profileImages.value);\r\n      selectedFile.value = null; \r\n\r\n      // ซ่อนข้อความแจ้งเตือนหลัง 3 วินาที\r\n      setTimeout(() => {\r\n        success.value = null;\r\n        error.value = null;\r\n      }, 3000);\r\n    } else {\r\n      error.value = 'เกิดข้อผิดพลาดในการเปลี่ยนแปลงโปรไฟล์';\r\n    }\r\n  } catch (e) {\r\n    error.value = 'เกิดข้อผิดพลาด: ' + e.message;\r\n  }\r\n};\r\n\r\nconst fetchUsersData = async () => {\r\n    try {\r\n        const token = localStorage.getItem('token');\r\n        const response = await axios.get('http://localhost:7000/user/get-user',{\r\n        headers: {\r\n            'authorization': `Bearer ${token}`\r\n        }   \r\n      });\r\n      const data = response.data;\r\n\r\n      console.log(data.user.profile);\r\n\r\n      if (data.ok === 1) {\r\n          profileImages.value = `http://localhost:7000/uploads/profiles/${data.user.profile}`;  // ใช้ชื่อไฟล์จากฐานข้อมูล\r\n          Username.value = data.user.username;  // กำหนดชื่อ\r\n          Email.value = data.user.email;  // กำหนดอีเมล\r\n      } else {\r\n          console.log('Error fetching student data:', data.error);\r\n      }\r\n  } catch (error) {\r\n      console.error('Error fetching student data:', error);\r\n  }\r\n}\r\n\r\n// เรียกใช้ฟังก์ชันเมื่อ component ถูก mount\r\nonMounted(() => {\r\n  fetchUsersData();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.background-body {\r\n  background: url('~/assets/images/background_1.jpg') no-repeat;\r\n  background-size: cover;\r\n  background-position: center;\r\n  border-radius: 10px 10px 100px 10px;\r\n  max-height: 100%;\r\n  position: relative;\r\n  overflow: hidden;\r\n  padding: 60px 0;\r\n  width: 100%;\r\n  z-index: 0;\r\n}\r\n\r\n.profile-section {\r\n  width: 100%;\r\n  padding-top: 2rem;\r\n  background-color: #f8f9fa;\r\n  border-radius: 0rem 0rem 2rem 2rem;\r\n}\r\n\r\n.avatar {\r\n  background-color: black;\r\n  border: 2px solid black;\r\n}\r\n\r\n.avatar-edit-btn {\r\n  position: absolute;\r\n  margin-top: 90%;\r\n}\r\n\r\n.container {\r\n  margin-top: 10px;\r\n}\r\n\r\n/* Alert */\r\n.alert-global {\r\n    position: fixed !important;\r\n    top: 30px;\r\n    left: 50%;\r\n    transform: translateX(-50%);\r\n    z-index: 999;\r\n    width: 90%;\r\n    max-width: 500px;\r\n    padding: 1rem 1.5rem;\r\n    border-radius: 10px;\r\n    font-size: 1.2rem;\r\n    box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);\r\n}\r\n.alert-global[v-type=\"error\"] {\r\n    background-color: #f8d7da;\r\n    color: #721c24;\r\n    border: 1px solid #f5c6cb;\r\n}\r\n.alert-global[v-type=\"success\"] {\r\n    background-color: #d4edda;\r\n    color: #155724;\r\n    border: 1px solid #c3e6cb;\r\n}\r\n</style>"],"version":3}