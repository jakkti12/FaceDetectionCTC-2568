{"file":"register-D-dsb8Tw.js","mappings":"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","names":["FooterComponent","_ssrRenderComponent"],"sources":["../../../../components/auth/RegisterComponent.vue","../../../../pages/auth/register.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"row text-center mt-5\">\r\n      <div class=\"col\">\r\n        <div class=\"p-2\">\r\n          <img style=\"width: 350px; border-radius: 100%;\" src=\"/assets/images/NewLogo.png\" alt=\"Logo\" />\r\n        </div>\r\n        <h2>สมัครสมาชิก</h2>\r\n        <p>\r\n          หรือ\r\n          <a href=\"/auth/login\" class=\"\">ลงชื่อเข้าใช้</a>\r\n        </p>\r\n      </div>\r\n    </div>\r\n    <div class=\"row mt-5 justify-content-center\">\r\n      <div class=\"col-md-8 col-lg-6\">\r\n        <div class=\"card\">\r\n          <div class=\"card-body\">\r\n            <div v-if=\"error\" class=\"error\">{{ error }}</div>\r\n            <form @submit.prevent=\"openDialog\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"inputUsername\" class=\"form-label\">ชื่อผู้ใช้</label>\r\n                <input v-model=\"username\" type=\"text\" class=\"form-control\" id=\"inputUsername\" required />\r\n              </div>\r\n              <div class=\"mb-3\">\r\n                <label for=\"inputEmail\" class=\"form-label\">อีเมล</label>\r\n                <input v-model=\"email\" type=\"email\" class=\"form-control\" id=\"inputEmail\" required />\r\n              </div>\r\n              <div class=\"mb-3\">\r\n                <label for=\"inputPassword\" class=\"form-label\">รหัสผ่าน</label>\r\n                <input v-model=\"password\" type=\"password\" class=\"form-control\" id=\"inputPassword\" required />\r\n              </div>\r\n              <div class=\"mb-3\">\r\n                <label for=\"inputConfirmPassword\" class=\"form-label\">ยืนยันรหัสผ่าน</label>\r\n                <input v-model=\"confirmPassword\" type=\"password\" class=\"form-control\" id=\"inputConfirmPassword\" required />\r\n              </div>\r\n              <v-dialog\r\n                v-model=\"dialog\"\r\n                max-width=\"80%\"\r\n                persistent\r\n              >\r\n                <template v-slot:activator=\"{ props: activatorProps }\">\r\n                  <v-btn v-bind=\"activatorProps\" class=\"w-100\" color=\"primary\">\r\n                    สมัครสมาชิก\r\n                  </v-btn>\r\n                </template>\r\n\r\n                <v-card prepend-icon=\"mdi-camera\" title=\"ตรวจสอบใบหน้า\">\r\n                  <div class=\"\">\r\n                    <!-- <h1>ตรวจสอบใบหน้าแบบ Real-Time</h1> -->\r\n                    <video ref=\"video\" autoplay muted playsinline></video>\r\n                    <canvas ref=\"canvas\" style=\"display: none;\"></canvas>\r\n                    <!-- กรอบที่จะแสดงผล -->\r\n                    <div \r\n                        v-for=\"(box, index) in faceBoxes\"\r\n                        class=\"face-box\"\r\n                        :key=\"index\"\r\n                        :style=\"{\r\n                          position: 'absolute',\r\n                          border: '2px solid red',\r\n                          top: `${box.y}px`,\r\n                          left: `${box.x}px`,\r\n                          width: `${box.width}px`,\r\n                          height: `${box.height}px`,\r\n                          pointerEvents: 'none',\r\n                        }\"\r\n                      ></div>\r\n                    <p>{{ status }}</p>\r\n                  </div>\r\n                  <v-card-actions>\r\n                    <v-spacer></v-spacer>\r\n                    <v-btn color=\"green\" @click=\"registerUser\">\r\n                      ลงทะเบียน\r\n                    </v-btn>\r\n                    <v-btn color=\"red\" @click=\"closeDialog\">\r\n                      ปิด\r\n                    </v-btn>\r\n                  </v-card-actions>\r\n                </v-card>\r\n              </v-dialog>\r\n            </form>\r\n            <hr />\r\n            <div class=\"text-center\">\r\n              <a href=\"/\" class=\"link-secondary\">กลับสู่หน้าหลัก</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport axios from 'axios'\r\nimport { ref, watch } from 'vue'\r\nimport { useRouter , useRoute  } from 'vue-router';\r\n\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst username = ref('')\r\nconst email = ref('')\r\nconst password = ref('')\r\nconst confirmPassword = ref('')\r\nconst error = ref(null)\r\nconst dialog = ref(false)\r\nconst status = ref('กำลังโหลด...')\r\nconst video = ref(null)\r\nconst stream = ref(null)\r\nconst intervalId = ref(null)\r\nconst faceBoxes = ref([])\r\nconst imageBase64 = ref('')\r\n\r\nconst openDialog = (e) => {\r\n  e.preventDefault()\r\n  if (password.value !== confirmPassword.value) {\r\n    error.value = 'รหัสผ่านไม่ตรงกัน'\r\n    return\r\n  }\r\n  dialog.value = true\r\n}\r\n\r\n// เริ่มใช้งานกล้อง\r\nconst startVideo = async () => {\r\n  try {\r\n    const mediaStream = await navigator.mediaDevices.getUserMedia({ video: true })\r\n    video.value.srcObject = mediaStream\r\n    stream.value = mediaStream\r\n    status.value = \"กำลังตรวจจับใบหน้า...\"\r\n    intervalId.value = setInterval(detectFace, 2000)\r\n  } catch (err) {\r\n    console.error(\"ไม่สามารถเข้าถึงกล้องได้:\", err)\r\n    status.value = \"ไม่สามารถเข้าถึงกล้องได้\"\r\n  }\r\n}\r\n\r\n// ปิดกล้อง\r\nconst closeDialog = () => {\r\n  dialog.value = false\r\n  if (stream.value) {\r\n    stream.value.getTracks().forEach(track => track.stop())\r\n    stream.value = null\r\n  }\r\n  status.value = \"กล้องถูกปิด\"\r\n  faceBoxes.value = []\r\n}\r\n\r\n// ตรวจจับใบหน้า\r\nconst detectFace = async () => {\r\n  if (!video.value) return;\r\n\r\n  const canvas = document.createElement('canvas');\r\n  const context = canvas.getContext(\"2d\");\r\n  const videoElement = video.value;\r\n\r\n  // กำหนดขนาดของ Canvas ตามวิดีโอ\r\n  canvas.width = videoElement.videoWidth;\r\n  canvas.height = videoElement.videoHeight;\r\n  context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);\r\n\r\n  // แปลงภาพเป็น Base64\r\n  imageBase64.value = canvas.toDataURL(\"image/jpeg\").split(',')[1];\r\n\r\n  try {\r\n    const response = await axios.post(\"http://localhost:8000/detect_face\", { image: imageBase64.value });\r\n\r\n    if (response.data.status === \"success\") {\r\n      const boundingBoxes = response.data.boundingBoxes;\r\n\r\n      // ขนาดวิดีโอที่แสดงผลบนหน้าเว็บจริง\r\n      const videoDisplayWidth = videoElement.clientWidth;\r\n      const videoDisplayHeight = videoElement.clientHeight;\r\n\r\n      // คำนวณอัตราส่วนเพื่อแปลงพิกเซลของเซิร์ฟเวอร์ให้ตรงกับวิดีโอบนหน้าเว็บ\r\n      const scaleX = videoDisplayWidth / canvas.width;\r\n      const scaleY = videoDisplayHeight / canvas.height;\r\n\r\n      // ปรับขนาดกรอบใบหน้าตามขนาดวิดีโอที่แสดงผล\r\n      faceBoxes.value = boundingBoxes.map(box => ({\r\n        x: box.x * scaleX,\r\n        y: box.y * scaleY,\r\n        width: box.width * scaleX,\r\n        height: box.height * scaleY\r\n      }));\r\n\r\n      status.value = \"ตรวจพบใบหน้า กรุณากดลงทะเบียน\";\r\n    } else {\r\n      faceBoxes.value = [];\r\n      status.value = \"ไม่พบใบหน้า\";\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Error detecting face:\", err.response?.data || err);\r\n    faceBoxes.value = [];\r\n    status.value = \"เกิดข้อผิดพลาด\";\r\n  }\r\n};\r\n\r\n// กดยืนยันการลงทะเบียน\r\nconst registerUser = async () => {\r\n  try {\r\n    const response = await axios.post(\"http://localhost:8000/register\", {\r\n      username: username.value,\r\n      email: email.value,\r\n      password: password.value,\r\n      image: imageBase64.value,\r\n    })\r\n\r\n    if (response.data.status === \"success\") {\r\n      alert(\"สมัครสมาชิกสำเร็จ\")\r\n      closeDialog()\r\n      router.push(\"/auth/login\")\r\n    } else {\r\n      alert(response.data.message)\r\n    }\r\n  } catch (err) {\r\n    alert(\"เกิดข้อผิดพลาดในการสมัคร\")\r\n  }\r\n}\r\n\r\nwatch(dialog, (newValue) => {\r\n  if (newValue) startVideo()\r\n  else closeDialog()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.error {\r\n  color: red;\r\n}\r\n\r\n.btn-block {\r\n  background-color: #007bff;\r\n}\r\n\r\n.video-container {\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  padding: 20px;\r\n}\r\n\r\nvideo {\r\n  width: 100%;\r\n  max-width: 600px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 20px;\r\n}\r\n\r\n.face-box {\r\n  position: absolute;\r\n  border: 2px solid red;\r\n  pointer-events: none;\r\n  margin-top: 5%;\r\n}\r\n</style>\r\n","<template>\r\n  <RegisterComponent />\r\n  <FooterComponent/>\r\n</template>\r\n\r\n<script>\r\nimport RegisterComponent from '~/components/auth/RegisterComponent.vue'\r\nimport FooterComponent from '~/components/footer/FooterComponent.vue'\r\n\r\nexport default {\r\n  components: {\r\n    RegisterComponent,\r\n    FooterComponent\r\n  },\r\n};\r\n</script>"],"version":3}